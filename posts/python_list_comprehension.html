<!DOCTYPE html>
<html>
<head>
	<title>Python List Comprehension</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

	<div class="container">

		<!-- START MENU -->
		<div class="header">
			<div>Hello! I'm <b>Ivan Ilievski</b>, and I Code</div>
			<span>
				<a href="https://ivanilievski.github.io/">Articles</a>
			</span> |
			<span>
				<a target="_blank" href="https://twitter.com/IvanIlievski_">Twitter</a>
			</span> | 
			<span>
				<a target="_blank" href="https://indiestartuplist.com/">IndieStartupList</a>
			</span>
		</div>
		<!-- END MENU -->

		<!-- START CONTENT -->
		<div class="content">

			<div class="title">

				<h1>Python List Comprehension</h1>

				<p class="date">
					<span>May 04, 2023</span>
					<span>by Ivan Ilievski</span>
				</p>
				
			</div>

			<p class="paragraph">List Comprehension is a powerful feature of Python for creating new lists based on existing lists in a more expressive way. It can help you write code that is easier to read and maintain, but also it will reduce the amount of code that you write. Plus, compared to normal functions and loops, list comprehension is faster for creating lists.

			<p>List comprehension is based on a simple syntax that consists of three parts:</p>
			<ul>
				<li>an expression</li>
				<li>a variable</li>
				<li>a list</li>
			</ul>
	
			<blockquote>
				<code>new_list = [expression for variable in original_list]</code>
			</blockquote>
			
			<p class="paragraph">The <b>expression</b> defines the operation to be performed on each element of the list, the <b>variable</b> represents the current element being operated on, and the <b>list</b> is the original list that is being transformed.
			That being said there is an optional fourth part that can be extremely useful when we want to filter elements. We use <b>conditions</b> to decide which elements to be included in the new list. If the condition is not used, all elements will be included.</p>

			<blockquote>
				<code>new_list = [expression for variable in original_list if condition]</code>
			</blockquote>

			<h3>List Comprehension in practice</h3>

			<p class="paragraph">Ok. So enough about theory, let's put our knowledge into practice. Writing your first list comprehension is very easy but to appreciate what list comprehension does for us we will write two versions to accomplish the same thing. One version with loops and functions and one with a list comprehension.</p>

			<img src="https://raw.githubusercontent.com/ivanilievski/ivanilievski.github.io/main/assets/one/code-snippet-1.png"/>

			<p class="paragraph">In the first example, we initialize an empty list called <b>number_list</b>. Then the for loop is created using the function <b>range()</b>. This function generates a sequence of numbers from 0 to 4. During each iteration of the loop, the current number is added to the empty list.</p>

			<p>Now let's look at the same problem solved by List Comprehension. Every list comprehension in Python must have the three elements we talked about before:</p>

			<ul>
				<li><b>expression</b>. In this case, we just have <b>a number</b> but it can have more complex expressions as we will see later.</li>
				<li><b>the variable</b> is <b>number</b>. I know is a little bit confusing but in the next example, it will be much more clear.</li>
				<li>We can see that the third part is not <b>list</b> as we specified earlier. But we just generate a sequence of numbers we use to make our list. Yes, so the third part of the list comprehension can be many different things. Like list, set, sequence, generator, etc.</li>
			</ul>
			

			<p class="paragraph">Rather than creating an empty list and adding each element to the end, you simply define the list and its contents at the same time. One of the many benefits of using list comprehensions. We did not use <b>the append</b> method and yet the numbers were pushed to the new list.</p>

			<img src="https://raw.githubusercontent.com/ivanilievski/ivanilievski.github.io/main/assets/one/code-snippet-2.png"/>

			<p class="paragraph">But we can do way more than just a single number in the expression. In the second example, we are calculating the square of 10 numbers in the list named <b>old_number_list</b>, so we write a simple calculation in the expression using the <b>**</b> operator. The rest of the code is concise and simple.</p>

			<p>Again we can recognize the three parts:</p>

			<ul>
				<li><b>number ** 2</b>  is the <b>expression</b>. Find the square of the number.</li>
				<li><b>variable</b> again is <b>a number</b>. Now, you get that expression and variable are different in the first example they were the same. But usually, they are not.</li>
				<li>We iterate over the <b>list</b> named <b>old_number_list</b> to find the square of each element in the list.</li>
			</ul>

			<img src="https://raw.githubusercontent.com/ivanilievski/ivanilievski.github.io/main/assets/one/code-snippet-3.png"/>

			<p class="paragraph">The third example is similar to the second except that we use the optional condition so we are creating a list of squared numbers but only even numbers.
			This list comprehension includes three elements plus the fort part or the <b>condition</b>, in this case, is <b>if number % 2 == 0</b> and we use it to filter the odd numbers and only add the even numbers to the list called <b>even_squared_numbers</b>.</p>

			<img src="https://raw.githubusercontent.com/ivanilievski/ivanilievski.github.io/main/assets/one/code-snippet-4.png"/>

			<p class="paragraph">Let's try list comprehension with strings. Some little kid messed with our list and now our list of capital cities is not properly written. We don't have time to rewrite each capital city from scratch so we used list comprehension to capitalize our capital city names.</p>

			<p>Nothing changed we still have the same organization:</p>

			<ul>
				<li><b>expression</b> is <b>city.capitalize()</b></li>
				<li><b>variable</b> is <b>city</b></li>
				<li>The <b>list</b> we iterate over is <b>incorect_capital_cities</b></li>
			</ul>

			<img src="https://raw.githubusercontent.com/ivanilievski/ivanilievski.github.io/main/assets/one/code-snippet-5.png"/>

			<p class="paragraph">As the examples go bigger we are starting to see the benefits we get from list comprehensions. In this example
			we have a list of lists, with each inner list representing a row in the matrix by the name of <b>nseted_list</b>.</p>

			<p>The list comprehension is used to flatten the nested_list and return a list of even numbers that are squared, but only if the sum of the numbers in the current row is greater than 10.</p>

			<ul>
				<li>number <b>**</b> 2 We find the square of the number</li>
				<li><b>if sum(row) > 10</b> check if the sum of numbers in a row is greater than 10.</li>
				<li><b>if number % 2 == 0</b> Check if the number is even.</li>
			</ul>

			<h3>Python Comprehension can be also used for sets and dictionaries</h3>	

			<p class="paragraph">Well, we don't have tuple comprehension because parenthesis is always used for generator expressions. But we do have Dictionary Comprehension and Set Comprehension.</p>

			<img src="https://raw.githubusercontent.com/ivanilievski/ivanilievski.github.io/main/assets/one/code-snippet-6.png"/>

			<p class="paragraph">A dictionary is similar to a list but instead of using indexes we use keys to access the value.</p>

			<p class="paragraph">In this example, we have two lists. We will use these two lists to create a dictionary.</p>

			<p class="paragraph">We use the zip() function to combine the two lists into a list of tuples. Each tuple contains a book genre and how many books have been read in that genre. For each tuple in the list of tuples created by zip(), a key-value pair is added to the dictionary. The key is the book genre, and the value is the number of books read in that genre.</p>
			 
			<img src="https://raw.githubusercontent.com/ivanilievski/ivanilievski.github.io/main/assets/one/code-snippet-7.png"/>

			<p class="paragraph">Set is a built-in data structure in Python that represents an unordered collection of unique elements. In a set, the order of elements does not matter. Set id defined using curly braces {} or the built-in set() function.</p>

			<p class="paragraph">In this example, we have two set comprehensions. In the first one, we have a list of numbers [1,2,1,3] but we only want the unique numbers. It's very similar to list comprehension except that we use curly braces {}.</p>

			<p class="paragraph">The second example has a string "hello world" and we want only the unique characters from the string. The rest of the code is very similar to our previous examples.</p>

			<p class="paragraph">This tutorial is about list comprehensions and not dictionary and set comprehensions. These examples are just a showcase that we can apply the same principles of comprehension to sets and dictionaries.</p>


			<h3>How to decide which tool to use</h3>


			<p class="paragraph">You probably know that you can solve the examples I provided using map and lambda functions, with generators, and loops. Why even bother with list comprehensions?</p>

			<p class="paragraph">It comes down to a simple question. Is performance important to the problem you are trying to solve? If performance is not important then go for the cleanest code solution. In my opinion, most of the time list comprehension is the winner.</p>

			<p class="paragraph">If performance is important then it's best to test different approaches and see which solution runs the fastest for the given problem.</p>

			<p class="paragraph">Python has provided us with a useful built-in Python module for measuring the execution time of small code snippets. It's called timeit.</p>

			<img src="https://raw.githubusercontent.com/ivanilievski/ivanilievski.github.io/main/assets/one/code-test-1.png"/>

			<p class="paragraph">In the last example, we take the problem of finding the square of a number and we run it 100000 times inside the timeit function. So the result is showing that the generator expression is the fastest. Let's make a leaderboard.</p>

			<p>Code execution leaderboard:</p>

			<ul>
				<li>Generator expression time: 0.037s</li>
				<li>List comprehension time: 0.359s</li>
				<li>For loop time: 0.370s</li>
				<li>Map and lambda time: 0.389s</li>
			</ul>

			<p class="paragraph">You probably think that the difference is not that big between loops and list comprehension but keep in mind this is a small problem. When you are faced with a bigger problem the difference will increase.</p>

			<p class="paragraph">Let's test it out. Let's test it 100000000 million times and see the result.</p>

			<img src="https://raw.githubusercontent.com/ivanilievski/ivanilievski.github.io/main/assets/one/code-test-2.png"/>

			<p class="paragraph">In the second example, we put some iron in the oven. Just kidding. After the execution is done we can see that list comprehension is faster than a map and for loops.

			<p class="paragraph">To address the elephant in the room. Yes, Generator expressions are the fastest but this is not a tutorial about them so for now as one wise man once said just don't worry about generator expressions. For now...

			<p class="paragraph">Rule of thumb if you work with huge datasets or on a mobile device with less power then just go with a generator expression.


			<h3>Conclusion</h3>

			<p class="paragraph">In this tutorial, you learned how to use list comprehension in Python. Also, you have learned for yourself how to decide which list-building method is right for your problem. I hope that this tutorial is useful to you. Stay tuned for more.</p>

			<p class="paragraph">All the code snippets are screenshots, but you can find the code <a href="https://github.com/ivanilievski/ivanilievski.github.io/blob/main/assets/notebooks/Article%20on%20Python%20List%20Comprehension.ipynb">here</a>. It's recommended that you type the code while reading the tutorial.</p>

	</div>

	<!-- START FOOTER -->
	<footer>
    	<p>&copy; 2024 Ivan Ilievski Blog. All rights reserved.</p>
	</footer>
	<!-- END FOOTER -->

	<!-- ONLY article.html -->
	<style type="text/css">

		.content {
			font-size: 18px;
			line-height: 1.8;
			border-bottom: 2px solid #404040;
		}

		.title {
			margin-bottom: 1.5em;
		}

		.title h1 {
			font-size: 36px;
			letter-spacing: -1.5px;
			line-height: 1;
			font-weight: 300;
			margin-bottom: 0px;
		}

		.date {
			font-style: italic;
			color: #a0a0a0;
			margin: 0;
		}

		.paragraph {
			margin-bottom: 1.5em;
			text-indent: 1em;
		}

		img {
			width: 100%;
			height: auto;
		}

		/* Media query for mobile devices */
		@media (max-width: 600px) {
	
			.content {
				font-size: 16px;
			}

			h1 {
				font-size: 20px;
			}
		}
		
	</style>

	<!-- START STYLE -->
	<style type="text/css">

		body {
			font-family: 'Helvetica', 'Arial', sans-serif;
			color: #404040;
			padding: 5px 10px;
		}

		.container {
			margin: 30px auto;
			width: 90%;
			max-width: 650px;
		}

		.header { 
			font-size: 22px; 
			padding: 10px;
		}

		.header a {
			text-decoration: none;
			color: #4169e1;
			font-weight: bold;
		}

		.header a:hover {
			color: #7b96ea;
		}

		/* Media query for mobile devices */
		@media (max-width: 600px) {
			body {
				font-size: 14px;
				padding: 0 0;
			}

			.container {
				margin: 0 0;
			}

			.header {
				font-size: 18px;
			}

			.content {
				font-size: 16px;
			}

			h1 {
				font-size: 20px;
			}
		}

	</style>
	<!-- END STYLE -->

</body>
</html>